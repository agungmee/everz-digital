<style>
  .testi {
    padding: 4.5rem 6vw 5rem;
    background: #fff7ee;
    color: #1d1b19;
  }

  .testi__count {
    text-align: center;
    margin-bottom: 2.8rem;
  }

  .testi__headline {
    margin: 0 auto;
    max-width: 620px;
    font-size: 1.1rem;
    color: #3f3b36;
  }

  .testi__count-number {
    font-family: "Anton", "Unbounded", sans-serif;
    font-size: clamp(2.6rem, 5vw + 1rem, 4.2rem);
    color: #ff7a45;
    letter-spacing: 0.06em;
    display: inline-block;
    margin: 0 0.3rem;
  }

  .testi__grid {
    display: grid;
    gap: 1.5rem;
    justify-items: center;
  }

  .testi__card {
    background: #fff;
    border-radius: 20px;
    padding: 1.6rem;
    box-shadow: 0 18px 36px rgba(20, 24, 22, 0.12);
    display: grid;
    gap: 0.7rem;
    text-align: center;
    max-width: 360px;
  }

  .testi__stars {
    color: #f2b705;
    font-size: 1.1rem;
    letter-spacing: 0.1rem;
  }

  .testi__text {
    margin: 0;
    color: #4a453f;
    line-height: 1.6;
  }

  .testi__name {
    font-weight: 600;
    color: #1d1b19;
  }

  @media (min-width: 960px) {
    .testi__grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>

<section class="testi" id="testimoni">
  <div class="testi__count">
    <p class="testi__headline">
      Sudah lebih dari
      <span class="testi__count-number" id="happyCounter">0</span>
      tamu happy dengan service kami.
    </p>
  </div>

  <div class="testi__grid">
    <article class="testi__card">
      <div class="testi__stars">★★★★★</div>
      <p class="testi__text">
        Armada bersih, AC dingin, dan sopirnya ramah. Perjalanan ke Guci
        menyenangkan dan tepat waktu.
      </p>
      <div class="testi__name">Ibu Rina, Tegal</div>
    </article>
    <article class="testi__card">
      <div class="testi__stars">★★★★★</div>
      <p class="testi__text">
        Tim Okta Wisata sangat responsif. Booking mudah, harga jelas, dan
        itinerary fleksibel sesuai request rombongan.
      </p>
      <div class="testi__name">Bapak Agus, Purwokerto</div>
    </article>
    <article class="testi__card">
      <div class="testi__stars">★★★★★</div>
      <p class="testi__text">
        Hiace Premio-nya nyaman banget untuk perjalanan keluarga. Sopirnya
        sabar dan paham rute wisata.
      </p>
      <div class="testi__name">Mbak Laila, Semarang</div>
    </article>
  </div>
</section>

<script>
  const initHappyCounter = () => {
    const counter = document.getElementById("happyCounter");
    const section = document.querySelector(".testi");
    if (!counter || !section || counter.dataset.ready === "true") {
      return false;
    }

    const startCounter = () => {
      const target = 1000;
      const duration = 1800;
      const start = performance.now();

      const tick = (now) => {
        const progress = Math.min((now - start) / duration, 1);
        const value = Math.floor(progress * target);
        counter.textContent = value.toLocaleString("id-ID");
        if (progress < 1) {
          requestAnimationFrame(tick);
        } else {
          counter.textContent = target.toLocaleString("id-ID");
        }
      };

      requestAnimationFrame(tick);
      counter.dataset.ready = "true";
    };

    if ("IntersectionObserver" in window) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              startCounter();
              observer.disconnect();
            }
          });
        },
        { threshold: 0.4 }
      );
      observer.observe(section);
    } else {
      startCounter();
    }

    return true;
  };

  const tryInitCounter = () => {
    if (initHappyCounter()) {
      return;
    }
    let attempts = 0;
    const timer = setInterval(() => {
      attempts += 1;
      if (initHappyCounter() || attempts > 20) {
        clearInterval(timer);
      }
    }, 300);
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", tryInitCounter);
  } else {
    tryInitCounter();
  }
</script>
